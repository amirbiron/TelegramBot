<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מדריך מקיף: איך לבנות בוטים יעילים ומקצועיים</title>
    <!-- Prism.js for syntax highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            line-height: 1.7;
            color: #2c3e50;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 60px 40px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 1%, transparent 71%);
            animation: pulse 10s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.3; }
        }
        
        h1 {
            font-size: 3em;
            margin-bottom: 20px;
            font-weight: 700;
            position: relative;
            z-index: 1;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .subtitle {
            font-size: 1.3em;
            opacity: 0.95;
            position: relative;
            z-index: 1;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }
        
        nav {
            background: #f8f9fa;
            padding: 30px 40px;
            border-bottom: 3px solid #e9ecef;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
            background: rgba(248, 249, 250, 0.95);
        }
        
        nav h2 {
            font-size: 1.5em;
            margin-bottom: 20px;
            color: #495057;
        }
        
        .nav-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .nav-item {
            background: white;
            padding: 15px 20px;
            border-radius: 10px;
            text-decoration: none;
            color: #495057;
            display: flex;
            align-items: center;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            font-weight: 500;
        }
        
        .nav-item:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        .nav-item .icon {
            font-size: 1.5em;
            margin-left: 10px;
        }
        
        .content {
            padding: 40px;
        }
        
        .section {
            margin-bottom: 60px;
            scroll-margin-top: 100px;
        }
        
        .section h2 {
            font-size: 2.5em;
            color: #2c3e50;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            padding-bottom: 15px;
            border-bottom: 3px solid #667eea;
        }
        
        .section h2 .icon {
            font-size: 1.2em;
            margin-left: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .section h3 {
            font-size: 1.8em;
            color: #495057;
            margin: 30px 0 20px;
            padding-right: 20px;
            border-right: 4px solid #764ba2;
        }
        
        .card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 25px;
            border-right: 5px solid #667eea;
            transition: all 0.3s ease;
        }
        
        .card:hover {
            transform: translateX(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .card h4 {
            color: #2c3e50;
            font-size: 1.4em;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        
        .card h4 .badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.7em;
            margin-right: 10px;
        }
        
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }
        
        .feature-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 25px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .feature-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transform: scaleX(0);
            transform-origin: right;
            transition: transform 0.3s ease;
        }
        
        .feature-card:hover::before {
            transform: scaleX(1);
        }
        
        .feature-card:hover {
            border-color: #667eea;
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.2);
        }
        
        .feature-title {
            font-size: 1.3em;
            color: #2c3e50;
            margin-bottom: 15px;
            font-weight: 600;
        }
        
        .feature-content {
            color: #6c757d;
            line-height: 1.6;
        }
        
        code {
            background: #f4f4f4;
            border: 1px solid #e1e4e8;
            border-radius: 5px;
            padding: 3px 8px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 0.9em;
            color: #e83e8c;
            direction: ltr;
            display: inline-block;
        }
        
        /* Enhanced code block styling with Prism.js integration */
        .code-block {
            background: #2d3748;
            border-radius: 10px;
            padding: 0;
            margin: 20px 0;
            overflow: hidden;
            position: relative;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .code-block pre {
            margin: 0;
            padding: 20px;
            overflow-x: auto;
            font-family: 'Fira Code', 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 0.9em;
            direction: ltr;
            text-align: left;
            line-height: 1.6;
            background: transparent;
        }
        
        .code-block code {
            background: transparent;
            border: none;
            padding: 0;
            color: inherit;
            font-size: inherit;
            direction: ltr;
            display: block;
        }
        
        /* Language label styling */
        .code-block .language-label {
            position: absolute;
            top: 10px;
            left: 15px;
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 0.75em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            z-index: 10;
        }
        
        /* Copy button styling */
        .code-block .copy-button {
            position: absolute;
            top: 10px;
            right: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #e2e8f0;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.75em;
            cursor: pointer;
            transition: all 0.2s ease;
            z-index: 10;
        }
        
        .code-block .copy-button:hover {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }
        
        .code-block .copy-button.copied {
            background: #48bb78;
            border-color: #48bb78;
        }
        
        /* Line numbers styling */
        .line-numbers .line-numbers-rows {
            border-left: 1px solid #4a5568;
            margin-left: -20px;
            padding-left: 15px;
        }
        
        .line-numbers-rows > span:before {
            color: #718096;
            font-size: 0.85em;
        }
        
        /* Custom Prism theme overrides for better RTL support */
        pre[class*="language-"] {
            background: #2d3748;
            color: #e2e8f0;
        }
        
        .token.comment,
        .token.prolog,
        .token.doctype,
        .token.cdata {
            color: #718096;
            font-style: italic;
        }
        
        .token.punctuation {
            color: #e2e8f0;
        }
        
        .token.property,
        .token.tag,
        .token.boolean,
        .token.number,
        .token.constant,
        .token.symbol,
        .token.deleted {
            color: #f687b3;
        }
        
        .token.selector,
        .token.attr-name,
        .token.string,
        .token.char,
        .token.builtin,
        .token.inserted {
            color: #68d391;
        }
        
        .token.operator,
        .token.entity,
        .token.url,
        .language-css .token.string,
        .style .token.string {
            color: #63b3ed;
        }
        
        .token.atrule,
        .token.attr-value,
        .token.keyword {
            color: #fbb6ce;
        }
        
        .token.function,
        .token.class-name {
            color: #faf089;
        }
        
        .token.regex,
        .token.important,
        .token.variable {
            color: #fc8181;
        }
        
        /* Remove old language label styles - now handled by JavaScript */
        
        .highlight-box {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            border-radius: 15px;
            padding: 25px;
            margin: 30px 0;
            border-right: 5px solid #667eea;
        }
        
        .highlight-box h4 {
            color: #764ba2;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        
        ul {
            padding-right: 30px;
            margin: 15px 0;
        }
        
        ul li {
            margin-bottom: 12px;
            position: relative;
            padding-right: 10px;
        }
        
        ul li::marker {
            color: #667eea;
        }
        
        .best-practice {
            background: #d4edda;
            border-right: 4px solid #28a745;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .best-practice::before {
            content: '✅ שיטה מומלצת';
            display: block;
            font-weight: bold;
            color: #28a745;
            margin-bottom: 10px;
        }
        
        .warning {
            background: #fff3cd;
            border-right: 4px solid #ffc107;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .warning::before {
            content: '⚠️ שימו לב';
            display: block;
            font-weight: bold;
            color: #856404;
            margin-bottom: 10px;
        }
        
        .metric-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .metric-card:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }
        
        .metric-value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .metric-label {
            font-size: 1.1em;
            opacity: 0.95;
        }
        
        footer {
            background: #2c3e50;
            color: white;
            padding: 40px;
            text-align: center;
        }
        
        footer p {
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .footer-links {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
        }
        
        .footer-links a {
            color: #667eea;
            text-decoration: none;
            transition: color 0.3s ease;
        }
        
        .footer-links a:hover {
            color: #764ba2;
        }
        
        .tech-stack {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
        }
        
        .tech-badge {
            background: white;
            border: 2px solid #667eea;
            color: #667eea;
            padding: 8px 15px;
            border-radius: 25px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .tech-badge:hover {
            background: #667eea;
            color: white;
            transform: scale(1.05);
        }
        
        @media (max-width: 768px) {
            h1 { font-size: 2em; }
            .section h2 { font-size: 1.8em; }
            .nav-grid { grid-template-columns: 1fr; }
            .content { padding: 20px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>🤖 מדריך מקיף ליצירת בוטים יציבים בטלגרם</h1>
            <p class="subtitle">
                לקחים מעשיים מפרויקט Code Keeper Bot - 
                איך לבנות בוטים יציבים, מהירים ומקצועיים עם ארכיטקטורה נכונה, 
                ניטור מתקדם ותחזוקה קלה
            </p>
        </header>
        
        <div style="background: #fff3cd; border-right: 4px solid #ffc107; padding: 25px 40px; margin: 0; text-align: center;">
            <p style="margin: 0; color: #856404; font-size: 1.1em; font-weight: 500;">
                💡 <strong>חדש בפיתוח בוטים לטלגרם?</strong><br>
                <span style="font-size: 0.95em;">מומלץ להתחיל עם 
                <a href="https://amirbiron.github.io/Telegram-Bot/" target="_blank" style="color: #0056b3; font-weight: bold;">המדריך הבסיסי לפיתוח בוט טלגרם</a> 
                לפני שממשיכים לטכניקות המתקדמות כאן</span>
            </p>
        </div>
        
        <nav>
            <h2>📚 תוכן העניינים</h2>
            <div class="nav-grid">
                <a href="#architecture" class="nav-item">
                    <span class="icon">⚙️</span>
                    <span>ארכיטקטורה נכונה</span>
                </a>
                <a href="#monitoring" class="nav-item">
                    <span class="icon">🧠</span>
                    <span>ניטור ובקרה</span>
                </a>
                <a href="#data" class="nav-item">
                    <span class="icon">💾</span>
                    <span>ניהול נתונים</span>
                </a>
                <a href="#testing" class="nav-item">
                    <span class="icon">🧪</span>
                    <span>בדיקות ואמינות</span>
                </a>
                <a href="#logging" class="nav-item">
                    <span class="icon">📊</span>
                    <span>לוגים חכמים</span>
                </a>
                <a href="#security" class="nav-item">
                    <span class="icon">🛡️</span>
                    <span>אבטחה</span>
                </a>
                <a href="#performance" class="nav-item">
                    <span class="icon">⚡</span>
                    <span>ביצועים</span>
                </a>
                <a href="#maintenance" class="nav-item">
                    <span class="icon">🔁</span>
                    <span>תחזוקה ושדרוגים</span>
                </a>
            </div>
        </nav>
        
        <div class="content">
            <!-- ארכיטקטורה -->
            <section id="architecture" class="section">
                <h2>
                    <span class="icon">⚙️</span>
                    ארכיטקטורה נכונה של בוטים
                </h2>
                
                <div class="card">
                    <h4>
                        <span class="badge">חשוב</span>
                        עקרונות יסוד בארכיטקטורה
                    </h4>
                    <p>ארכיטקטורה טובה היא הבסיס לבוט יציב וקל לתחזוקה. הפרדת אחריות ברורה בין שכבות מאפשרת פיתוח מהיר ותחזוקה קלה.</p>
                </div>
                
                <h3>🎯 הפרדת שכבות (Layered Architecture)</h3>
                
                <div class="feature-grid">
                    <div class="feature-card">
                        <div class="feature-title">📱 שכבת Handlers</div>
                        <div class="feature-content">
                            <p>מטפלים בקלט מהמשתמש ומנתבים לפעולות המתאימות.</p>
                            <p style="margin-top: 15px; color: #6c757d; font-size: 0.95em;">הדוגמה הבאה מראה איך להגדיר handler לקובץ שמאציל את העבודה לשכבת השירות ומציג תוצאות למשתמש בצורה נקייה.</p>
                            <div class="code-block python">
# handlers/file_view.py
async def show_file(update, context):
    """מטפל בבקשה להצגת קובץ"""
    user_id = update.effective_user.id
    file_name = context.args[0]
    
    # האצלה לשכבת השירות
    file_data = await file_service.get_file(user_id, file_name)
    
    # פורמט והצגה למשתמש
    await update.message.reply_text(
        format_file_display(file_data),
        parse_mode='HTML'
    )</div>
                        </div>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-title">🔧 שכבת Services</div>
                        <div class="feature-content">
                            <p>לוגיקה עסקית מרוכזת, ללא תלות בממשק המשתמש.</p>
                            <p style="margin-top: 15px; color: #6c757d; font-size: 0.95em;">השכבה הזו מרכזת את כל הלוגיקה העסקית, כולל בדיקת הרשאות ועיבוד נתונים, בנפרד מהממשק.</p>
                            <div class="code-block python">
# services/file_service.py
class FileService:
    async def get_file(self, user_id: int, file_name: str):
        # בדיקת הרשאות
        if not self.check_permissions(user_id, file_name):
            raise PermissionError()
        
        # טעינה מהמסד/cache
        file_data = await self.repository.get(user_id, file_name)
        
        # עיבוד ועשרת הנתונים
        return self.enrich_file_data(file_data)</div>
                        </div>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-title">💾 שכבת Repository</div>
                        <div class="feature-content">
                            <p>גישה למסד הנתונים, מופשטת ומרוכזת.</p>
                            <p style="margin-top: 15px; color: #6c757d; font-size: 0.95em;">דפוס Repository מפריד בין הלוגיקה העסקית לשכבת הנתונים ומאפשר החלפת מסד נתונים בקלות ומרכז את כל הפעולות על הנתונים.</p>
                            <div class="code-block python">
# database/repository.py
class FileRepository:
    def __init__(self, db_connection):
        self.db = db_connection
    
    async def get(self, user_id: int, file_name: str):
        return await self.db.collection('files').find_one({
            'user_id': user_id,
            'file_name': file_name
        })
    
    async def save(self, file_data: dict):
        return await self.db.collection('files').insert_one(file_data)</div>
                        </div>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-title">🌐 Conversation States</div>
                        <div class="feature-content">
                            <p>ניהול מצבי שיחה מרכזי ומסודר.</p>
                            <p style="margin-top: 15px; color: #6c757d; font-size: 0.95em;">ConversationHandler מאפשר ניהול שיחות רב-שלביות עם המשתמש, כמו תהליך שמירת קוד.</p>
                            <div class="code-block python">
# handlers/states.py
GET_CODE, GET_FILENAME, GET_NOTE = range(3)

# שימוש ב-ConversationHandler
conv_handler = ConversationHandler(
    entry_points=[CommandHandler('save', save_start)],
    states={
        GET_FILENAME: [MessageHandler(filters.TEXT, get_filename)],
        GET_CODE: [MessageHandler(filters.TEXT, get_code)]
    },
    fallbacks=[CommandHandler('cancel', cancel)]
)</div>
                        </div>
                    </div>
                </div>
                
                <h3>⚡ עיבוד אסינכרוני</h3>
                
                <div class="best-practice">
                    <p>השתמש ב-async/await בכל מקום אפשרי למניעת חסימות ושיפור ביצועים:</p>
                    <p style="margin-top: 15px; color: #6c757d; font-size: 0.95em;">עיבוד אסינכרוני מאפשר טיפול במספר בקשות במקביל ושיפור דרמטי בביצועים.</p>
                    <div class="code-block python">
# עיבוד אסינכרוני יעיל
async def process_multiple_files(files):
    tasks = []
    for file in files:
        tasks.append(process_file(file))
    
    # עיבוד מקבילי
    results = await asyncio.gather(*tasks)
    return results

# Lazy Loading לקבצים גדולים
class LazyLoader:
    async def get_file_chunk(self, file_id, chunk_index):
        # טעינת רק החלק הנדרש
        chunk = await self.load_chunk(file_id, chunk_index)
        return chunk</div>
                </div>
                
                <h3>📦 מודולריות וארגון קבצים</h3>
                
                <div class="highlight-box">
                    <h4>מבנה תיקיות מומלץ</h4>
                    <p style="margin-top: 15px; color: #6c757d; font-size: 0.95em;">מבנה תיקיות מסודר מאפשר תחזוקה קלה ופיתוח מהיר. כל רכיב במקום המתאים לו.</p>
                    <div class="code-block bash">
project/
├── handlers/         # מטפלי פקודות
│   ├── __init__.py
│   ├── file_view.py
│   └── states.py
├── services/         # לוגיקה עסקית
│   ├── file_service.py
│   └── code_processor.py
├── database/         # שכבת נתונים
│   ├── models.py
│   └── repository.py
├── utils/            # כלים עזר
├── tests/            # בדיקות
└── main.py          # נקודת כניסה</div>
                </div>
            </section>
            
            <!-- ניטור ובקרה -->
            <section id="monitoring" class="section">
                <h2>
                    <span class="icon">🧠</span>
                    ניטור ובקרה מתקדמים
                </h2>
                
                <h3>📊 Structured Logging עם structlog</h3>
                
                <div class="card">
                    <h4>למה Structured Logging?</h4>
                    <p>לוגים מובנים מאפשרים חיפוש וניתוח קלים, correlation בין אירועים, ואינטגרציה עם כלי ניטור.</p>
                    <p style="margin-top: 15px; color: #6c757d; font-size: 0.95em;">structlog יוצר לוגים בפורמט JSON עם context אוטומטי, מה שמקל על חיפוש וניתוח בכלי ניטור.</p>
                    <div class="code-block python">
# observability.py
import structlog

def setup_structlog_logging():
    structlog.configure(
        processors=[
            structlog.contextvars.merge_contextvars,
            add_request_id,          # הוספת request_id
            redact_sensitive,        # הסתרת מידע רגיש
            structlog.processors.TimeStamper(fmt="iso"),
            structlog.processors.JSONRenderer()
        ],
        wrapper_class=structlog.make_filtering_bound_logger(logging.INFO),
    )

# שימוש
logger = structlog.get_logger()
logger.info("file_saved", 
    user_id=user_id,
    file_name=file_name, 
    size_bytes=file_size,
    duration_ms=processing_time
)</div>
                </div>
                
                <h3>📈 מטריקות עם Prometheus</h3>
                
                <div class="feature-grid">
                    <div class="feature-card">
                        <div class="feature-title">מדידת ביצועים</div>
                        <div class="feature-content">
                            <p style="margin-bottom: 15px; color: #6c757d; font-size: 0.95em;">Prometheus מאפשר איסוף מטריקות בזמן אמת ויצירת גרפים ו-alerts על ביצועי המערכת.</p>
                            <div class="code-block python">
# metrics.py
from prometheus_client import Counter, Histogram, Gauge

# הגדרת מטריקות
errors_total = Counter('errors_total', 'Total errors', ['code'])
operation_latency = Histogram('operation_latency_seconds', 
                              'Operation latency', ['operation'])
active_users = Gauge('active_users', 'Currently active users')

# שימוש עם context manager
@contextmanager
def track_performance(operation: str):
    start = time.time()
    try:
        yield
    finally:
        duration = time.time() - start
        operation_latency.labels(operation=operation).observe(duration)</div>
                        </div>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-title">Request ID Tracking</div>
                        <div class="feature-content">
                            <p style="margin-bottom: 15px; color: #6c757d; font-size: 0.95em;">Request ID ייחודי לכל בקשה מאפשר מעקב אחר כל הפעולות הקשורות אליה בלוגים.</p>
                            <div class="code-block python">
# Correlation ID לכל בקשה
def generate_request_id() -> str:
    return str(uuid.uuid4())[:8]

async def handle_update(update, context):
    request_id = generate_request_id()
    structlog.contextvars.bind_contextvars(
        request_id=request_id,
        user_id=update.effective_user.id
    )
    
    logger.info("request_started")
    try:
        await process_request(update, context)
        logger.info("request_completed")
    except Exception as e:
        logger.error("request_failed", error=str(e))</div>
                        </div>
                    </div>
                </div>
                
                <h3>🚨 Error Tracking עם Sentry</h3>
                
                <div class="best-practice">
                    <p style="margin-bottom: 15px; color: #6c757d; font-size: 0.95em;">Sentry אוסף אוטומטית שגיאות בפרודקשן ומספק context מלא כולל stack trace ומשתנים.</p>
                    <div class="code-block python">
# אינטגרציה עם Sentry
import sentry_sdk

def init_sentry():
    if SENTRY_DSN := os.getenv("SENTRY_DSN"):
        sentry_sdk.init(
            dsn=SENTRY_DSN,
            traces_sample_rate=0.1,  # 10% מהבקשות
            environment=os.getenv("ENV", "production"),
            before_send=redact_sensitive_data,
            integrations=[
                AsyncioIntegration(),
                LoggingIntegration(level=logging.ERROR)
            ]
        )

# דיווח שגיאות מותאם אישית
def report_critical_error(error, context=None):
    with sentry_sdk.push_scope() as scope:
        if context:
            scope.set_context("operation", context)
        sentry_sdk.capture_exception(error)</div>
                </div>
            </section>
            
            <!-- ניהול נתונים -->
            <section id="data" class="section">
                <h2>
                    <span class="icon">💾</span>
                    ניהול נתונים ו-Cache חכם
                </h2>
                
                <h3>🗄️ Database Design Patterns</h3>
                
                <div class="feature-grid">
                    <div class="feature-card">
                        <div class="feature-title">Repository Pattern</div>
                        <div class="feature-content">
                            <p>הפרדת לוגיקת הגישה למסד הנתונים:</p>
                            <div class="code-block python">
class BaseRepository:
    def __init__(self, collection_name: str):
        self.collection = db[collection_name]
    
    async def find_one(self, query: dict):
        return await self.collection.find_one(query)
    
    async def insert(self, document: dict):
        document['created_at'] = datetime.utcnow()
        return await self.collection.insert_one(document)
    
    async def update(self, query: dict, updates: dict):
        updates['updated_at'] = datetime.utcnow()
        return await self.collection.update_one(
            query, {"$set": updates}
        )</div>
                        </div>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-title">Connection Pooling</div>
                        <div class="feature-content">
                            <div class="code-block python">
# database/manager.py
class DatabaseManager:
    def __init__(self):
        self.client = None
        self.db = None
    
    def connect(self):
        self.client = AsyncIOMotorClient(
            MONGODB_URL,
            maxPoolSize=50,
            minPoolSize=10,
            maxIdleTimeMS=30000,
            retryWrites=True
        )
        self.db = self.client[DB_NAME]
        
        # יצירת אינדקסים
        self.create_indexes()
    
    async def create_indexes(self):
        await self.db.files.create_index(
            [("user_id", 1), ("file_name", 1)],
            unique=True
        )</div>
                        </div>
                    </div>
                </div>
                
                <h3>⚡ Redis Cache Strategy</h3>
                
                <div class="card">
                    <h4>
                        <span class="badge">ביצועים</span>
                        אסטרטגיית Cache יעילה
                    </h4>
                    <p style="margin-top: 15px; color: #6c757d; font-size: 0.95em;">Redis cache עם decorators אוטומטיים מאיץ את הבוט פי כמה ומפחית עומס על ה-DB.</p>
                    <div class="code-block python">
# cache_manager.py
class CacheManager:
    def __init__(self):
        self.redis_client = redis.from_url(
            REDIS_URL,
            decode_responses=True,
            socket_connect_timeout=5,
            health_check_interval=30
        )
    
    @cached(expire_seconds=300, key_prefix="user_files")
    async def get_user_files(self, user_id: int):
        # נקרא רק אם אין בcache
        return await db.get_user_files(user_id)
    
    def invalidate_user_cache(self, user_id: int):
        pattern = f"user_files:{user_id}:*"
        for key in self.redis_client.scan_iter(pattern):
            self.redis_client.delete(key)

# Decorator לcaching אוטומטי
def cached(expire_seconds=300, key_prefix=""):
    def decorator(func):
        @wraps(func)
        async def wrapper(*args, **kwargs):
            cache_key = f"{key_prefix}:{args}:{kwargs}"
            
            # נסיון לקרוא מcache
            if cached_value := cache.get(cache_key):
                return cached_value
            
            # חישוב ושמירה בcache
            result = await func(*args, **kwargs)
            cache.set(cache_key, result, expire=expire_seconds)
            return result
        return wrapper
    return decorator</div>
                </div>
                
                <h3>🔄 Batch Processing</h3>
                
                <div class="highlight-box">
                    <h4>עיבוד יעיל של מספר רב של פריטים</h4>
                    <p style="margin-top: 15px; color: #6c757d; font-size: 0.95em;">עיבוד batch עם ThreadPoolExecutor מאפשר טיפול יעיל במספר רב של קבצים במקביל.</p>
                    <div class="code-block python">
class BatchProcessor:
    def __init__(self):
        self.max_workers = 3
        self.batch_size = 50
    
    async def process_files_batch(self, files, operation):
        """עיבוד מקבילי עם הגבלת threads"""
        with ThreadPoolExecutor(max_workers=self.max_workers) as executor:
            futures = []
            
            # חלוקה לbatches
            for batch in chunks(files, self.batch_size):
                future = executor.submit(operation, batch)
                futures.append(future)
            
            # איסוף תוצאות עם progress tracking
            results = []
            for future in as_completed(futures):
                result = future.result()
                results.extend(result)
                await self.report_progress(len(results), len(files))
            
            return results</div>
                </div>
            </section>
            
            <!-- בדיקות -->
            <section id="testing" class="section">
                <h2>
                    <span class="icon">🧪</span>
                    בדיקות ואמינות
                </h2>
                
                <h3>🎯 אסטרטגיית בדיקות</h3>
                
                <div class="metric-grid">
                    <div class="metric-card">
                        <div class="metric-value">80%+</div>
                        <div class="metric-label">כיסוי קוד מינימלי</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">Unit</div>
                        <div class="metric-label">בדיקות יחידה מהירות</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">Integration</div>
                        <div class="metric-label">בדיקות אינטגרציה</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">E2E</div>
                        <div class="metric-label">בדיקות מקצה לקצה</div>
                    </div>
                </div>
                
                <h3>✅ Unit Testing Best Practices</h3>
                
                <div class="feature-card">
                    <div class="feature-title">Mock חכם עם pytest</div>
                    <div class="feature-content">
                        <p style="margin-bottom: 15px; color: #6c757d; font-size: 0.95em;">הדוגמה הבאה מציגה איך לבדוק פונקציות אסינכרוניות עם pytest ו-AsyncMock, כולל בדיקה של מקרים מוצלחים ושגיאות צפויות.</p>
                        <div class="code-block python">
# tests/test_file_service.py
import pytest
from unittest.mock import Mock, AsyncMock

@pytest.fixture
def mock_db():
    """Fixture למסד נתונים מדומה"""
    db = Mock()
    db.get_file = AsyncMock(return_value={
        'file_name': 'test.py',
        'content': 'print("hello")'
    })
    return db

@pytest.fixture
def file_service(mock_db):
    """Fixture לservice עם תלויות מדומות"""
    from services.file_service import FileService
    return FileService(db=mock_db)

@pytest.mark.asyncio
async def test_get_file_success(file_service):
    """בדיקת טעינת קובץ מוצלחת"""
    result = await file_service.get_file(123, 'test.py')
    
    assert result is not None
    assert result['file_name'] == 'test.py'
    file_service.db.get_file.assert_called_once_with(123, 'test.py')

@pytest.mark.asyncio
async def test_get_file_not_found(file_service):
    """בדיקת טיפול בקובץ לא קיים"""
    file_service.db.get_file.return_value = None
    
    with pytest.raises(FileNotFoundError):
        await file_service.get_file(123, 'missing.py')</div>
                    </div>
                </div>
                
                <h3>📊 Coverage & CI/CD</h3>
                
                <div class="card">
                    <h4>הגדרת pytest עם coverage</h4>
                    <p style="margin-top: 15px; color: #6c757d; font-size: 0.95em;">קובץ הגדרות pytest שמבטיח כיסוי קוד מינימלי ויוצר דוחות coverage אוטומטיים.</p>
                    <div class="code-block yaml">
# pytest.ini
[pytest]
addopts = 
    --cov=.
    --cov-report=term-missing
    --cov-report=xml
    --cov-fail-under=80
testpaths = tests

# codecov.yml
coverage:
  status:
    project:
      default:
        target: 80%
        threshold: 2%
    patch:
      default:
        target: 60%</div>
                </div>
                
                <div class="best-practice">
                    <h4>GitHub Actions לבדיקות אוטומטיות</h4>
                    <p style="margin-top: 15px; color: #6c757d; font-size: 0.95em;">CI pipeline שמריץ בדיקות אוטומטית על כל push ו-PR, כולל מספר גרסאות Python.</p>
                    <div class="code-block yaml">
# .github/workflows/ci.yml
name: CI Pipeline

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: [3.11, 3.12]
    
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-python@v5
      with:
        python-version: ${{ matrix.python-version }}
    
    - name: Install dependencies
      run: |
        pip install -r requirements.txt
        pip install pytest pytest-cov pytest-asyncio
    
    - name: Run tests
      run: pytest --cov --cov-report=xml
    
    - name: Upload coverage
      uses: codecov/codecov-action@v3
      with:
        file: ./coverage.xml</div>
                </div>
            </section>
            
            <!-- לוגים חכמים -->
            <section id="logging" class="section">
                <h2>
                    <span class="icon">📊</span>
                    שקיפות ולוגים חכמים
                </h2>
                
                <h3>🎨 פורמט לוגים אחיד</h3>
                
                <div class="card">
                    <h4>JSON Structured Logging</h4>
                    <p style="margin-top: 15px; color: #6c757d; font-size: 0.95em;">לוגים בפורמט JSON מאפשרים חיפוש וניתוח קל בכלי ניטור כמו Elasticsearch או CloudWatch.</p>
                    <div class="code-block python">
# לוג דוגמה בפורמט JSON
{
    "timestamp": "2024-01-15T10:30:45.123Z",
    "level": "INFO",
    "request_id": "abc123",
    "user_id": 12345,
    "operation": "file_save",
    "file_name": "example.py",
    "size_bytes": 2048,
    "duration_ms": 45,
    "status": "success"
}

# קוד ליצירת הלוג
logger.info(
    "file_operation",
    operation="save",
    file_name=file_name,
    size_bytes=len(content),
    duration_ms=int((time.time() - start) * 1000),
    status="success"
)</div>
                </div>
                
                <h3>🔍 Log Levels Strategy</h3>
                
                <div class="feature-grid">
                    <div class="feature-card">
                        <div class="feature-title">DEBUG</div>
                        <div class="feature-content">
                            פרטים טכניים לפיתוח: ערכי משתנים, מצב פנימי
                        </div>
                    </div>
                    <div class="feature-card">
                        <div class="feature-title">INFO</div>
                        <div class="feature-content">
                            אירועים חשובים: התחלת/סיום פעולות, הצלחות
                        </div>
                    </div>
                    <div class="feature-card">
                        <div class="feature-title">WARNING</div>
                        <div class="feature-content">
                            בעיות לא קריטיות: ערכים חריגים, fallbacks
                        </div>
                    </div>
                    <div class="feature-card">
                        <div class="feature-title">ERROR</div>
                        <div class="feature-content">
                            שגיאות שדורשות תשומת לב: כשלונות, exceptions
                        </div>
                    </div>
                </div>
                
                <h3>🛡️ הסתרת מידע רגיש</h3>
                
                <div class="warning">
                    <p style="margin-bottom: 15px; color: #6c757d; font-size: 0.95em;">פונקציה להסתרת מידע רגיש בלוגים - חיונית למניעת חשיפת סיסמאות וטוקנים.</p>
                    <div class="code-block python">
def redact_sensitive(event_dict):
    """הסתרת מידע רגיש בלוגים"""
    sensitive_keys = {
        'token', 'password', 'secret', 
        'authorization', 'cookie', 'api_key'
    }
    
    for key in list(event_dict.keys()):
        if any(s in key.lower() for s in sensitive_keys):
            event_dict[key] = "[REDACTED]"
    
    # הסתרת חלקים מטלפונים
    if 'phone' in event_dict:
        phone = event_dict['phone']
        event_dict['phone'] = phone[:3] + "****" + phone[-2:]
    
    return event_dict</div>
                </div>
            </section>
            
            <!-- אבטחה -->
            <section id="security" class="section">
                <h2>
                    <span class="icon">🛡️</span>
                    אבטחה ו-Permissions
                </h2>
                
                <h3>🔐 הצפנת מידע רגיש</h3>
                
                <div class="card">
                    <h4>הצפנת טוקנים ב-Database</h4>
                    <p style="margin-top: 15px; color: #6c757d; font-size: 0.95em;">הצפנת מידע רגיש לפני שמירה ב-DB עם Fernet encryption - חיונית להגנה על נתוני משתמשים.</p>
                    <div class="code-block python">
# secret_manager.py
from cryptography.fernet import Fernet

class SecretManager:
    def __init__(self):
        key = os.getenv("TOKEN_ENC_KEY")
        self.cipher = Fernet(key) if key else None
    
    def encrypt_secret(self, plaintext: str) -> str:
        if not self.cipher:
            return plaintext  # fallback לפיתוח
        
        encrypted = self.cipher.encrypt(plaintext.encode())
        return f"enc:{encrypted.decode()}"
    
    def decrypt_secret(self, ciphertext: str) -> str:
        if not ciphertext.startswith("enc:"):
            return ciphertext
        
        encrypted = ciphertext[4:].encode()
        return self.cipher.decrypt(encrypted).decode()

# שימוש
secret_mgr = SecretManager()
encrypted_token = secret_mgr.encrypt_secret(user_token)
db.save_user_token(user_id, encrypted_token)</div>
                </div>
                
                <h3>⚡ Rate Limiting</h3>
                
                <div class="feature-card">
                        <div class="feature-title">הגבלת קצב בקשות</div>
                        <div class="feature-content">
                            <p style="margin-bottom: 15px; color: #6c757d; font-size: 0.95em;">Rate limiting מונע spam והתקפות DDoS על הבוט שלך ומגן על המשאבים.</p>
                            <div class="code-block python">
class RateLimiter:
    def __init__(self, max_per_minute: int = 30):
        self.max_per_minute = max_per_minute
        self.requests = defaultdict(list)
    
    async def check_rate_limit(self, user_id: int) -> bool:
        now = datetime.now(timezone.utc)
        one_min_ago = now - timedelta(seconds=60)
        
        # ניקוי בקשות ישנות
        user_requests = self.requests[user_id]
        user_requests[:] = [
            req for req in user_requests 
            if req > one_min_ago
        ]
        
        # בדיקת מגבלה
        if len(user_requests) >= self.max_per_minute:
            return False
        
        user_requests.append(now)
        return True

# Decorator לשימוש קל
def rate_limited(max_per_minute=30):
    limiter = RateLimiter(max_per_minute)
    
    def decorator(func):
        async def wrapper(update, context):
            user_id = update.effective_user.id
            
            if not await limiter.check_rate_limit(user_id):
                await update.message.reply_text(
                    "⚠️ יותר מדי בקשות. נסה שוב בעוד דקה."
                )
                return
            
            return await func(update, context)
        return wrapper
    return decorator</div>
                    </div>
                </div>
                
                <h3>🔒 Security Best Practices</h3>
                
                <div class="highlight-box">
                    <h4>רשימת בדיקה לאבטחה</h4>
                    <ul>
                        <li>✅ אף פעם לא לשמור סיסמאות בטקסט רגיל</li>
                        <li>✅ להשתמש במשתני סביבה למידע רגיש</li>
                        <li>✅ לבדוק הרשאות בכל פעולה</li>
                        <li>✅ להגביל קצב בקשות למניעת spam</li>
                        <li>✅ לסנן קלט משתמשים (SQL injection, XSS)</li>
                        <li>✅ להסתיר מידע רגיש בלוגים</li>
                        <li>✅ להשתמש ב-HTTPS תמיד</li>
                        <li>✅ לעדכן תלויות באופן קבוע</li>
                    </ul>
                </div>
            </section>
            
            <!-- ביצועים -->
            <section id="performance" class="section">
                <h2>
                    <span class="icon">⚡</span>
                    אופטימיזציה וביצועים
                </h2>
                
                <h3>🚀 Lazy Loading Strategy</h3>
                
                <div class="card">
                    <h4>טעינה עצלה לקבצים גדולים</h4>
                    <p style="margin-top: 15px; color: #6c757d; font-size: 0.95em;">Lazy loading עם pagination מאפשר הצגת קבצים גדולים בלי לטעון את כולם לזכרון.</p>
                    <div class="code-block python">
class LazyLoader:
    def __init__(self):
        self.chunk_size = 50  # שורות בכל chunk
        self.max_file_size = 5000  # מעל זה = קובץ גדול
    
    async def get_file_chunk(self, file_id: str, chunk_index: int):
        """טוען רק את החלק הנדרש מהקובץ"""
        # חישוב offset
        start = chunk_index * self.chunk_size
        end = start + self.chunk_size
        
        # טעינה ממוקדת מהDB
        chunk = await db.get_file_lines(file_id, start, end)
        
        return {
            'content': chunk,
            'chunk_index': chunk_index,
            'has_more': end < await db.get_file_length(file_id)
        }
    
    def create_navigation(self, current_chunk, total_chunks):
        """יוצר כפתורי ניווט בין chunks"""
        buttons = []
        
        if current_chunk > 0:
            buttons.append(("⬅️ קודם", f"chunk:{current_chunk-1}"))
        
        buttons.append((f"{current_chunk+1}/{total_chunks}", "info"))
        
        if current_chunk < total_chunks - 1:
            buttons.append(("➡️ הבא", f"chunk:{current_chunk+1}"))
        
        return buttons</div>
                </div>
                
                <h3>🔄 Connection Pooling</h3>
                
                <div class="best-practice">
                    <p style="margin-bottom: 15px; color: #6c757d; font-size: 0.95em;">כך מגדירים מאגר חיבורים (pool) למסד הנתונים ול-Redis כדי לשפר ביצועים ולהפחית עומס על השרת.</p>
                    <div class="code-block python">
# ניהול חיבורים יעיל
class DatabasePool:
    def __init__(self):
        self.pool = AsyncIOMotorClient(
            MONGODB_URL,
            maxPoolSize=50,      # מקסימום חיבורים
            minPoolSize=10,      # מינימום חיבורים
            maxIdleTimeMS=30000, # timeout לחיבורים לא פעילים
            serverSelectionTimeoutMS=5000,
            retryWrites=True
        )
    
    async def get_connection(self):
        """מחזיר חיבור זמין מהpool"""
        return self.pool.get_database()

# Redis connection pool
redis_pool = redis.ConnectionPool(
    host='localhost',
    port=6379,
    max_connections=50,
    decode_responses=True
)</div>
                </div>
                
                <h3>📊 Performance Metrics</h3>
                
            </section>
            
            <!-- תחזוקה -->
            <section id="maintenance" class="section">
                <h2>
                    <span class="icon">🔁</span>
                    תחזוקה ושדרוגים אוטומטיים
                </h2>
                
                <h3>📦 Dependabot Configuration</h3>
                
                <div class="card">
                    <h4>עדכוני תלויות אוטומטיים</h4>
                    <p style="margin-top: 15px; color: #6c757d; font-size: 0.95em;">Dependabot יוצר PRs אוטומטיים לעדכוני תלויות ושומר על האפליקציה מעודכנת ומאובטחת.</p>
                    <div class="code-block yaml">
# .github/dependabot.yml
version: 2
updates:
  - package-ecosystem: "pip"
    directory: "/"
    schedule:
      interval: "weekly"
      day: "sunday"
      time: "02:00"
    open-pull-requests-limit: 10
    allow:
      - dependency-type: "all"
    
  # Auto-merge לעדכוני patch
  - package-ecosystem: "github-actions"
    directory: "/"
    schedule:
      interval: "weekly"</div>
                </div>
                
                <h3>🐳 Docker Best Practices</h3>
                
                <div class="feature-grid">
                    <div class="feature-card">
                        <div class="feature-title">Multi-stage Build</div>
                        <div class="feature-content">
                            <p style="margin-bottom: 15px; color: #6c757d; font-size: 0.95em;">זהו מבנה Docker דו-שלבי (multi-stage) שמקטין את גודל התמונה ומשפר את מהירות הפריסה.</p>
                            <div class="code-block dockerfile">
# Stage 1: Builder
FROM python:3.12-slim AS builder
WORKDIR /app
COPY requirements.txt .
RUN pip install --user --no-cache-dir -r requirements.txt

# Stage 2: Production
FROM python:3.12-slim AS production
# Non-root user
RUN useradd -m -u 1000 botuser
USER botuser

# Copy only needed files
COPY --from=builder /root/.local /home/botuser/.local
COPY --chown=botuser:botuser . /app

WORKDIR /app
ENV PATH=/home/botuser/.local/bin:$PATH

# Health check
HEALTHCHECK --interval=30s --timeout=10s \
  CMD python -c "import sys; sys.exit(0)"

CMD ["python", "main.py"]</div>
                        </div>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-title">Deployment Strategy</div>
                        <div class="feature-content">
                            <p style="margin-bottom: 15px; color: #6c757d; font-size: 0.95em;">קובץ הגדרות ל-Render.com עם auto-deploy מה-main branch ובדיקות תקינות אוטומטיות.</p>
                            <div class="code-block yaml">
# render.yaml
services:
  - type: web
    name: my-bot
    env: python
    plan: free
    
    buildCommand: |
      pip install --upgrade pip
      pip install -r requirements.txt
    
    startCommand: python main.py
    
    healthCheckPath: /health
    
    envVars:
      - key: PYTHON_VERSION
        value: 3.12
      - key: LOG_LEVEL
        value: INFO
    
    # Auto-deploy from main
    autoDeploy: true</div>
                        </div>
                    </div>
                </div>
                
                <h3>🔄 Graceful Shutdown</h3>
                
                <div class="best-practice">
                    <p style="margin-bottom: 15px; color: #6c757d; font-size: 0.95em;">הקטע הבא מדגים סגירה מבוקרת של תהליכים בבוט כדי למנוע איבוד נתונים או תקיעות.</p>
                    <div class="code-block python">
# main.py
import signal
import asyncio

class BotApplication:
    def __init__(self):
        self.running = True
        self.tasks = []
    
    async def shutdown(self):
        """כיבוי מסודר של הבוט"""
        logger.info("Starting graceful shutdown...")
        
        # עצירת קבלת בקשות חדשות
        self.running = False
        
        # המתנה לסיום משימות פעילות
        if self.tasks:
            logger.info(f"Waiting for {len(self.tasks)} tasks to complete...")
            await asyncio.gather(*self.tasks, return_exceptions=True)
        
        # סגירת חיבורים
        await self.close_database()
        await self.close_cache()
        
        logger.info("Graceful shutdown completed")
    
    def setup_signal_handlers(self):
        """הגדרת טיפול בסיגנלים"""
        for sig in (signal.SIGTERM, signal.SIGINT):
            signal.signal(sig, lambda s, f: asyncio.create_task(self.shutdown()))

if __name__ == "__main__":
    app = BotApplication()
    app.setup_signal_handlers()
    asyncio.run(app.run())</div>
                </div>
                
                <h3>📈 Monitoring & Alerts</h3>
                
                <div class="highlight-box">
                    <h4>מערכת התראות חכמה</h4>
                    <ul>
                        <li>🔴 שגיאות קריטיות - התראה מיידית</li>
                        <li>🟡 אזהרות - סיכום יומי</li>
                        <li>🔵 מידע - לוגים לניתוח</li>
                        <li>📊 מטריקות ביצועים - דשבורד real-time</li>
                    </ul>
                    
                    <p style="margin-top: 15px; color: #6c757d; font-size: 0.95em;">Alert Manager חכם שמחליט אילו שגיאות דורשות התראה מיידית ואילו לא, כדי למנוע spam.</p>
                    <div class="code-block python">
# Alert manager
class AlertManager:
    async def send_critical_alert(self, error):
        """שליחת התראה דחופה"""
        if self.should_alert(error):
            await self.notify_admin(
                level="CRITICAL",
                message=str(error),
                context=self.get_error_context()
            )
    
    def should_alert(self, error):
        """החלטה חכמה מתי להתריע"""
        # לא להתריע על שגיאות ידועות/צפויות
        if isinstance(error, RateLimitError):
            return False
        
        # התראה רק אחרי 3 כשלונות
        if self.error_count(error) < 3:
            return False
        
        return True</div>
                </div>
            </section>
            
            <!-- סיכום -->
            <section class="section">
                <h2>
                    <span class="icon">🎯</span>
                    סיכום ועקרונות מנחים
                </h2>
                
                <div class="feature-grid">
                    <div class="feature-card">
                        <div class="feature-title">🏗️ ארכיטקטורה נקייה</div>
                        <div class="feature-content">
                            הפרדת שכבות, מודולריות, וקוד ניתן לתחזוקה
                        </div>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-title">📊 ניטור מקיף</div>
                        <div class="feature-content">
                            לוגים מובנים, מטריקות, ומעקב אחר שגיאות
                        </div>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-title">🧪 בדיקות אוטומטיות</div>
                        <div class="feature-content">
                            כיסוי גבוה, CI/CD, ובדיקות בכל שכבה
                        </div>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-title">⚡ ביצועים מעולים</div>
                        <div class="feature-content">
                            Cache חכם, lazy loading, ועיבוד אסינכרוני
                        </div>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-title">🛡️ אבטחה מובנית</div>
                        <div class="feature-content">
                            הצפנה, rate limiting, והרשאות מדוקדקות
                        </div>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-title">🔄 תחזוקה קלה</div>
                        <div class="feature-content">
                            עדכונים אוטומטיים, deployment פשוט, וdocker
                        </div>
                    </div>
                </div>
                
                <div class="highlight-box">
                    <h4>🚀 הטכנולוגיות שהשתמשנו</h4>
                    <div class="tech-stack">
                        <span class="tech-badge">Python 3.11+</span>
                        <span class="tech-badge">AsyncIO</span>
                        <span class="tech-badge">MongoDB</span>
                        <span class="tech-badge">Redis</span>
                        <span class="tech-badge">Docker</span>
                        <span class="tech-badge">GitHub Actions</span>
                        <span class="tech-badge">Pytest</span>
                        <span class="tech-badge">Structlog</span>
                        <span class="tech-badge">Prometheus</span>
                        <span class="tech-badge">Sentry</span>
                        <span class="tech-badge">Dependabot</span>
                        <span class="tech-badge">Codecov</span>
                    </div>
                </div>
                
                <div class="best-practice">
                    <h4>העיקרון החשוב ביותר</h4>
                    <p style="font-size: 1.2em; line-height: 1.8;">
                        <strong>התחל פשוט, אבל תכנן לגדול.</strong><br>
                        בנה בסיס איתן עם ארכיטקטורה נכונה, בדיקות, וניטור מההתחלה.
                        זה יחסוך לך זמן רב בהמשך ויאפשר לבוט שלך לגדול ולהתפתח בקלות.
                    </p>
                </div>
            </section>
        </div>
        
        <footer>
            <p>
                📚 מבוסס על הניסיון מפיתוח <strong>Code Keeper Bot</strong> - 
                בוט Telegram מתקדם לניהול קוד עם 10,000+ שורות קוד
            </p>
            <div class="footer-links">
                <a href="https://github.com/amirbiron/CodeBot" target="_blank">🔗 GitHub Repository</a>
                <a href="https://amirbiron.github.io/CodeBot/" target="_blank">📖 Documentation</a>
                <a href="https://t.me/my_code_keeper_bot" target="_blank">🤖 Try the Bot</a>
            </div>
            <p style="margin-top: 30px; opacity: 0.8;">
                נבנה עם ❤️ לקהילת המפתחים
            </p>
        </footer>
    </div>
    
    <!-- Prism.js scripts for syntax highlighting -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script>
    
    <script>
        // Initialize syntax highlighting with enhanced features
        document.addEventListener('DOMContentLoaded', function() {
            // Convert existing code blocks to Prism format
            const codeBlocks = document.querySelectorAll('.code-block');
            
            codeBlocks.forEach(function(block) {
                // Determine language from class or content
                let language = 'python'; // default
                if (block.textContent.includes('version:') || block.textContent.includes('services:')) {
                    language = 'yaml';
                } else if (block.textContent.includes('FROM ') || block.textContent.includes('RUN ')) {
                    language = 'dockerfile';
                } else if (block.textContent.includes('#!/bin/bash') || block.textContent.includes('pip install')) {
                    language = 'bash';
                } else if (block.textContent.includes('def ') || block.textContent.includes('import ') || block.textContent.includes('async ')) {
                    language = 'python';
                }
                
                // Create proper Prism structure
                const pre = document.createElement('pre');
                const code = document.createElement('code');
                
                pre.className = `language-${language} line-numbers`;
                code.className = `language-${language}`;
                code.textContent = block.textContent.trim();
                
                pre.appendChild(code);
                
                // Add language label
                const label = document.createElement('div');
                label.className = 'language-label';
                label.textContent = getLanguageLabel(language);
                
                // Add copy button
                const copyBtn = document.createElement('button');
                copyBtn.className = 'copy-button';
                copyBtn.textContent = 'העתק';
                copyBtn.onclick = function() {
                    navigator.clipboard.writeText(code.textContent).then(function() {
                        copyBtn.textContent = 'הועתק!';
                        copyBtn.classList.add('copied');
                        setTimeout(function() {
                            copyBtn.textContent = 'העתק';
                            copyBtn.classList.remove('copied');
                        }, 2000);
                    });
                };
                
                // Replace old block with new structure
                block.innerHTML = '';
                block.appendChild(label);
                block.appendChild(copyBtn);
                block.appendChild(pre);
            });
            
            // Highlight all code blocks
            Prism.highlightAll();
        });
        
        function getLanguageLabel(lang) {
            const labels = {
                'python': 'Python',
                'yaml': 'YAML',
                'bash': 'Bash',
                'dockerfile': 'Dockerfile',
                'javascript': 'JavaScript',
                'json': 'JSON',
                'css': 'CSS',
                'html': 'HTML'
            };
            return labels[lang] || lang.toUpperCase();
        }
        
        // Enhanced copy functionality
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('copy-button')) {
                const codeBlock = e.target.closest('.code-block');
                const code = codeBlock.querySelector('code');
                
                if (navigator.clipboard) {
                    navigator.clipboard.writeText(code.textContent).then(function() {
                        e.target.textContent = 'הועתק!';
                        e.target.classList.add('copied');
                        setTimeout(function() {
                            e.target.textContent = 'העתק';
                            e.target.classList.remove('copied');
                        }, 2000);
                    }).catch(function() {
                        // Fallback for older browsers
                        const textArea = document.createElement('textarea');
                        textArea.value = code.textContent;
                        document.body.appendChild(textArea);
                        textArea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textArea);
                        
                        e.target.textContent = 'הועתק!';
                        e.target.classList.add('copied');
                        setTimeout(function() {
                            e.target.textContent = 'העתק';
                            e.target.classList.remove('copied');
                        }, 2000);
                    });
                }
            }
        });
    </script>
</body>
</html>
